@(identity: Option[String])

@import fragments.toggle

@main("CSRF example app", identity) {
    <div class="container">
        <h2>Instructions</h2>
        <p>
            <b>CSRF is an attack that tricks the victim into submitting a malicious request</b>.
            It inherits the identity and privileges of the victim to perform an undesired function on the victim's behalf.
            For most sites, browser requests automatically include any credentials associated with the site,
            such as the user's session cookie, IP address, Windows domain credentials, and so forth.
            Therefore, if the user is currently authenticated (logged-in),
            the application will have no way to distinguish between the forged request sent by the victim and a legitimate request sent by the victim.
        </p>
        <p>
            CSRF attacks target functionality that causes a state change on the server,
            such as changing the victim's email address or password, or purchasing something.
            Forcing the victim to retrieve data doesn't benefit an attacker because the attacker
            doesn't receive the response, the victim does.
            As such, <b>CSRF attacks target state-changing requests</b>.
        </p>

        <h3>Getting started</h3>
        <ul class="collapsible instructions" data-collapsible="accordion">
            <li>
                <div class="collapsible-header"><i class="material-icons left">face</i>Use the application</div>
                <div class="collapsible-body">
                    <p>
                        This is an example application that is vulnerable to CSRF attacks.
                        To start off, have a browse round the site to get a feel for how it works.
                        The navigation at the top of the page shows you what the application does.
                    </p>
                    <p>
                        Note that some pages will require a login.
                        For simplicity's sake there's no real registration in this demo,
                        any combination of username and password will work.
                    </p>
                </div>
            </li>
            <li>
                <div class="collapsible-header"><i class="material-icons left">assignment</i>Create and delete some entries</div>
                <div class="collapsible-body">
                    <p>
                        This is a demo application that allows users to create "entries",
                        which are simple notes with a title and description.
                        Users can create new "entries" and view a list of their own existing entries.
                        They can also delete existing entries from the list page.
                    </p>
                    <p>
                        Try creating and deleting some records.
                        Pay attention to how the application works.
                        Can you spot any vulnerabilities?
                    </p>
                </div>
            </li>
        </ul>

        <h3>Exercises</h3>
        <ul class="collapsible instructions" data-collapsible="accordion">
            <li>
                <div class="collapsible-header"><i class="material-icons left">help</i>CSRF</div>
                <div class="collapsible-body">
                    <p>
                        <b>CSRF is an attack that tricks the victim into submitting a malicious request</b>.
                        It inherits the identity and privileges of the victim to perform an undesired function on the victim's behalf.
                        For most sites, browser requests automatically include any credentials associated with the site,
                        such as the user's session cookie, IP address, Windows domain credentials, and so forth.
                        Therefore, if the user is currently authenticated to the site,
                        the site will have no way to distinguish between the forged request sent by the victim and a legitimate request sent by the victim.
                    </p>
                    <p>
                        CSRF attacks target functionality that causes a state change on the server,
                        such as changing the victim's email address or password, or purchasing something.
                        Forcing the victim to retrieve data doesn't benefit an attacker because the attacker
                        doesn't receive the response, the victim does.
                        As such, <b>CSRF attacks target state-changing requests</b>.
                    </p>
                </div>
            </li>
            <li>
                <div class="collapsible-header"><i class="material-icons left">link</i>Crafting malicious links</div>
                <div class="collapsible-body">
                    <p>
                        Can you create a link that will delete a record?
                    </p>
                    <p>
                        Can you email it to yourself?
                    </p>
                    <p>
                        Can you think of ways to make people more likely to click on that link?
                    </p>
                    @toggle("Extra questions") {
                        <p>What does the user have to do to be vulnerable?</p>
                        <p>Why does this work?</p>
                    }
                </div>
            </li>
            <li>
                <div class="collapsible-header"><i class="material-icons left">developer_mode</i>Creating a malicious web page</div>
                <div class="collapsible-body">
                    <p>
                        Is it possible to make a webpage that will create a record on behalf of the user?
                    </p>
                    @toggle("Hint") {
                        <p>
                            You create a record by submitting the form on this website.
                            Can you try putting a form on your own webpage instead?
                        </p>
                    }
                    <p>
                        How might you trick the user into submitting your form?
                    </p>
                    <p>
                        Can you work out a way to submit the form without any user interaction?
                    </p>
                    @toggle("Hint") {
                        <p>
                            Clicking submit isn't the only way to submit a form!
                            Is there a way to trigger a form submission from JavaScript?
                        </p>
                    }
                    <p>
                        Can you make the form submit automatically without changing the current page?
                        This means the user will be completely unaware that you've managed to create entries on their behalf.
                    </p>
                    @toggle("Hint") {
                        <p>
                            Submitting a form will cause the containing page to update.
                            Could you embed a different web page within this one?
                        </p>
                    }
                </div>
            </li>
            <li>
                <div class="collapsible-header"><i class="material-icons left">do_not_disturb_on</i>Stealth-mode</div>
                <div class="collapsible-body">
                </div>
            </li>
            <li>
                <div class="collapsible-header"><i class="material-icons left">build</i>Combining it all</div>
                <div class="collapsible-body">
                    <!--
                        Script:
                        fetch all a user's entries, send them to another application
                        delete all their entries when that's done
                        add lots of your own entries to their account
                    -->
                </div>
            </li>
        </ul>

        <h3>Mitigation</h3>
        <p>

        </p>

        <h3>Congratulations</h3>
        <p>
            You've successfully exploited a CSRF vulnerability on this website.
            Now that you understand how they work, can you think of any websites you use where this sort of
            vulnerability would be a problem?
        </p>
        <p>
            For more information on CSRF vulnerabilities, you can go on and do some
            <a href="/further-reading">further reading</a> on this site.
        </p>
    </div>
}
